{% extends 'base.html' %}

{% block title %}–ì–ª–∞–≤–Ω–∞—è - –ú–æ–∏ –§–∏–Ω–∞–Ω—Å—ã{% endblock %}

{% block extra_css %}
<style>
    .stats-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 30px;
    }

    .stat-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 16px;
        padding: 30px;
        color: #fff;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }

    .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }

    .stat-card.income {
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    }

    .stat-card.outcome {
        background: linear-gradient(135deg, #ee0979 0%, #ff6a00 100%);
    }

    .stat-card h3 {
        font-size: 16px;
        opacity: 0.9;
        margin-bottom: 10px;
    }

    .stat-card .amount {
        font-size: 36px;
        font-weight: bold;
        margin-bottom: 5px;
    }

    .period-selector {
        display: flex;
        gap: 10px;
        margin-top: 20px;
        flex-wrap: wrap;
    }

    .period-btn {
        padding: 8px 16px;
        background: rgba(255,255,255,0.2);
        border: none;
        border-radius: 20px;
        color: #fff;
        cursor: pointer;
        transition: all 0.3s;
        text-decoration: none;
        font-size: 14px;
    }

    .period-btn:hover {
        background: rgba(255,255,255,0.3);
    }

    .period-btn.active {
        background: rgba(255,255,255,0.4);
        font-weight: bold;
    }

    .wallets-section {
        margin-bottom: 30px;
    }

    .wallet-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 15px;
        margin-top: 20px;
    }

    .wallet-card {
        background: #fff;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        transition: all 0.3s;
        cursor: pointer;
    }

    .wallet-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 4px 15px rgba(0,0,0,0.12);
    }

    .wallet-type {
        display: inline-block;
        padding: 4px 12px;
        background: #e3f2fd;
        color: #1976d2;
        border-radius: 12px;
        font-size: 12px;
        margin-bottom: 10px;
    }

    .wallet-name {
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 8px;
        color: #333;
    }

    .wallet-balance {
        font-size: 24px;
        font-weight: bold;
        color: #4CAF50;
    }

    .total-balance {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: #fff;
        padding: 25px;
        border-radius: 12px;
        margin-bottom: 20px;
        text-align: center;
    }

    .total-balance h3 {
        font-size: 16px;
        opacity: 0.9;
        margin-bottom: 10px;
    }

    .total-balance .amount {
        font-size: 42px;
        font-weight: bold;
    }

    .recent-transactions {
        margin-top: 30px;
    }

    .transaction-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px;
        background: #fff;
        border-radius: 8px;
        margin-bottom: 10px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }

    .transaction-info {
        flex: 1;
    }

    .transaction-category {
        font-weight: 600;
        color: #333;
        margin-bottom: 4px;
    }

    .transaction-date {
        font-size: 12px;
        color: #999;
    }

    .transaction-amount {
        font-size: 18px;
        font-weight: bold;
    }

    .transaction-amount.income {
        color: #4CAF50;
    }

    .transaction-amount.outcome {
        color: #f44336;
    }

    @media (max-width: 768px) {
        .stats-grid {
            grid-template-columns: 1fr;
        }

        .wallet-grid {
            grid-template-columns: 1fr;
        }

        .stat-card .amount {
            font-size: 28px;
        }
    }
</style>
{% endblock %}

{% block content %}
<h1 style="margin-bottom: 30px; color: #333;">üìä –û–±–∑–æ—Ä —Ñ–∏–Ω–∞–Ω—Å–æ–≤</h1>

<!-- –û–±—â–∏–π –±–∞–ª–∞–Ω—Å -->
<div class="total-balance">
    <h3>üíº –û–±—â–∏–π –±–∞–ª–∞–Ω—Å</h3>
    <div class="amount">{{ total_balance_uzs|floatformat:0 }} —Å—É–º</div>
    {% if total_balance_usd > 0 %}
        <div style="margin-top: 10px; font-size: 20px;">{{ total_balance_usd|floatformat:2 }} $</div>
    {% endif %}
</div>

<!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–æ—Ö–æ–¥–æ–≤/—Ä–∞—Å—Ö–æ–¥–æ–≤ -->
<div class="stats-grid">
    <a href="{% url 'transaction_list' 'income' %}" style="text-decoration: none;">
        <div class="stat-card income">
            <h3>üìà –î–æ—Ö–æ–¥—ã</h3>
            <div class="amount">{{ total_income|floatformat:0 }}</div>
            <div style="opacity: 0.8;">–∑–∞ {{ period_display|lower }}</div>
            
            <div class="period-selector">
                <a href="?period=day" class="period-btn {% if period == 'day' %}active{% endif %}">–î–µ–Ω—å</a>
                <a href="?period=week" class="period-btn {% if period == 'week' %}active{% endif %}">–ù–µ–¥–µ–ª—è</a>
                <a href="?period=month" class="period-btn {% if period == 'month' %}active{% endif %}">–ú–µ—Å—è—Ü</a>
                <a href="?period=year" class="period-btn {% if period == 'year' %}active{% endif %}">–ì–æ–¥</a>
            </div>
        </div>
    </a>

    <a href="{% url 'transaction_list' 'outcome' %}" style="text-decoration: none;">
        <div class="stat-card outcome">
            <h3>üìâ –†–∞—Å—Ö–æ–¥—ã</h3>
            <div class="amount">{{ total_outcome|floatformat:0 }}</div>
            <div style="opacity: 0.8;">–∑–∞ {{ period_display|lower }}</div>
            
            <div class="period-selector">
                <a href="?period=day" class="period-btn {% if period == 'day' %}active{% endif %}">–î–µ–Ω—å</a>
                <a href="?period=week" class="period-btn {% if period == 'week' %}active{% endif %}">–ù–µ–¥–µ–ª—è</a>
                <a href="?period=month" class="period-btn {% if period == 'month' %}active{% endif %}">–ú–µ—Å—è—Ü</a>
                <a href="?period=year" class="period-btn {% if period == 'year' %}active{% endif %}">–ì–æ–¥</a>
            </div>
        </div>
    </a>
</div>

<!-- –ö–æ—à–µ–ª—å–∫–∏ -->
<div class="wallets-section">
    <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
        <span>üëõ –ú–æ–∏ –∫–æ—à–µ–ª—å–∫–∏</span>
        <a href="{% url 'wallet_add' %}" class="btn btn-small">+ –î–æ–±–∞–≤–∏—Ç—å</a>
    </div>
    
    <div class="wallet-grid">
        {% for wallet in wallets %}
            <a href="{% url 'wallet_detail' wallet.pk %}" style="text-decoration: none; color: inherit;">
                <div class="wallet-card">
                    <span class="wallet-type">
                        {% if wallet.type == 'cash' %}üíµ –ù–∞–ª–∏—á–Ω—ã–µ
                        {% elif wallet.type == 'uzcard' %}üí≥ UzCard
                        {% elif wallet.type == 'visa' %}üíé Visa
                        {% endif %}
                    </span>
                    <div class="wallet-name">{{ wallet.name }}</div>
                    <div class="wallet-balance">
                        {{ wallet.balance|floatformat:0 }} 
                        {% if wallet.currency == 'UZS' %}—Å—É–º{% else %}${% endif %}
                    </div>
                </div>
            </a>
        {% empty %}
            <p style="color: #999; grid-column: 1/-1;">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∫–æ—à–µ–ª—å–∫–æ–≤. <a href="{% url 'wallet_add' %}">–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π –∫–æ—à–µ–ª—ë–∫</a></p>
        {% endfor %}
    </div>
</div>

<!-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ -->
<div class="recent-transactions">
    <div class="card">
        <div class="card-header">üïí –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏</div>
        
        {% for transaction in recent_transactions %}
            <div class="transaction-item">
                <div class="transaction-info">
                    <div class="transaction-category">
                        {{ transaction.category.name|default:"–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏" }}
                    </div>
                    <div class="transaction-date">
                        {{ transaction.created_at|date:"d.m.Y H:i" }} ‚Ä¢ {{ transaction.wallet.name }}
                    </div>
                    {% if transaction.description %}
                        <div style="font-size: 13px; color: #666; margin-top: 4px;">
                            {{ transaction.description|truncatewords:10 }}
                        </div>
                    {% endif %}
                </div>
                <div class="transaction-amount {{ transaction.type }}">
                    {% if transaction.type == 'income' %}+{% else %}-{% endif %}
                    {{ transaction.amount|floatformat:0 }}
                </div>
            </div>
        {% empty %}
            <p style="color: #999; text-align: center; padding: 20px;">–ü–æ–∫–∞ –Ω–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</p>
        {% endfor %}
        
        {% if recent_transactions %}
            <div style="text-align: center; margin-top: 20px;">
                <a href="{% url 'transaction_list' 'income' %}" class="btn btn-secondary btn-small">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ</a>
            </div>
        {% endif %}
    </div>
</div>

<!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
<div style="display: flex; gap: 15px; margin-top: 30px; flex-wrap: wrap;">
    <a href="{% url 'manage_money' %}" class="btn">üí∏ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤–∞–º–∏</a>
    <a href="{% url 'wallet_add' %}" class="btn btn-secondary">+ –î–æ–±–∞–≤–∏—Ç—å –∫–æ—à–µ–ª—ë–∫</a>
</div>
{% endblock %}