{% extends 'base.html' %}

{% block title %}–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤–∞–º–∏{% endblock %}

{% block extra_css %}
<style>
:root {
    --income:#2ecc71;
    --outcome:#e74c3c;
    --gradient:linear-gradient(135deg,#667eea,#764ba2);
}

.form-container{
    max-width:600px;
    margin:40px auto;
    background:#fff;
    border-radius:20px;
    overflow:hidden;
    box-shadow:0 15px 35px rgba(0,0,0,.1);
}

.header{
    background:var(--gradient);
    color:#fff;
    padding:30px;
    text-align:center;
    position:relative;
}
.back-link{
    position:absolute;
    left:20px;
    top:30px;
    color:#fff;
    text-decoration:none;
    opacity:.8;
}
.form-body{padding:30px}

.wallet-card{
    background:linear-gradient(135deg,#1d2671,#c33764);
    color:#fff;
    padding:20px;
    border-radius:16px;
    margin-bottom:25px;
}
.wallet-name{font-size:14px;opacity:.9}
.wallet-balance{font-size:30px;font-weight:800}

.form-group{margin-bottom:20px}
label{font-weight:600;margin-bottom:6px;display:block}

.form-control{
    width:100%;
    padding:14px;
    border-radius:10px;
    border:2px solid #eee;
    font-size:16px;
}

.type-switch{
    display:flex;
    gap:10px;
}
.type-btn{
    flex:1;
    padding:14px;
    text-align:center;
    border-radius:12px;
    border:2px solid #eee;
    font-weight:700;
    cursor:pointer;
}
.type-btn.income{color:var(--income)}
.type-btn.outcome{color:var(--outcome)}
.type-btn.active.income{background:#eafaf1;border-color:var(--income)}
.type-btn.active.outcome{background:#fdecec;border-color:var(--outcome)}

.amount-wrap{position:relative}
.amount-wrap input{
    font-size:26px;
    font-weight:700;
    padding-right:70px;
}
.currency{
    position:absolute;
    right:10px;
    top:50%;
    transform:translateY(-50%);
    background:#667eea;
    color:#fff;
    padding:6px 10px;
    border-radius:8px;
}

.quick-amounts{
    display:flex;
    gap:8px;
    margin-top:10px;
}
.quick-amounts button{
    flex:1;
    padding:8px;
    border-radius:8px;
    border:none;
    cursor:pointer;
}

.radio{
    display:flex;
    gap:8px;
    margin-bottom:10px;
}

.hidden{display:none}

.btn-submit{
    width:100%;
    padding:16px;
    border-radius:12px;
    border:none;
    color:#fff;
    font-size:18px;
    font-weight:700;
    cursor:pointer;
}
.btn-income{background:var(--income)}
.btn-outcome{background:var(--outcome)}

.errorlist{
    background:#fff5f5;
    color:var(--outcome);
    padding:8px;
    border-radius:8px;
    margin-top:6px;
    font-size:13px;
}
</style>
{% endblock %}

{% block content %}
<div class="form-container">

    <div class="header">
        <a href="{% url 'wallet_detail' wallet.pk %}" class="back-link">‚Üê –ù–∞–∑–∞–¥</a>
        <h1 id="form-title">üí∞ –ù–æ–≤–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è</h1>
    </div>

    <form method="post" class="form-body">
        {% csrf_token %}

        <!-- –ö–ê–†–¢–ê -->
        <div class="wallet-card">
            <div class="wallet-name">{{ wallet.name }}</div>
            <div class="wallet-balance">
                {{ wallet.balance }} {{ wallet.currency }}
            </div>
        </div>

        <!-- TYPE -->
        <input type="hidden" name="type" id="id_type" value="income">

        <div class="form-group">
            <label>–¢–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏ *</label>
            <div class="type-switch">
                <div id="btn-income" class="type-btn income active" onclick="setType('income')">üì• –î–æ—Ö–æ–¥</div>
                <div id="btn-outcome" class="type-btn outcome" onclick="setType('outcome')">üì§ –†–∞—Å—Ö–æ–¥</div>
            </div>
        </div>

        <!-- –°–£–ú–ú–ê -->
        <div class="form-group">
            <label>–°—É–º–º–∞ *</label>
            <div class="amount-wrap">
                <input type="number" name="amount" id="id_amount" min="1" class="form-control" required>
                <span class="currency">{{ wallet.currency }}</span>
            </div>

            <div class="quick-amounts">
                <button type="button" onclick="addAmount(1000)">+1 000</button>
                <button type="button" onclick="addAmount(5000)">+5 000</button>
                <button type="button" onclick="addAmount(10000)">+10 000</button>
                <button type="button" onclick="addAmount(50000)">+50 000</button>
            </div>

            {% if form.amount.errors %}
                <div class="errorlist">{{ form.amount.errors }}</div>
            {% endif %}
        </div>

        <!-- –ö–ê–¢–ï–ì–û–†–ò–Ø -->
        <div class="form-group">
            <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è *</label>

            <div class="radio">
                <input type="radio" name="cat_mode" value="old" checked onclick="toggleCat(false)">
                <label>–í—ã–±—Ä–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é</label>
            </div>

            <div id="cat-old-box">
                {{ form.category }}
            </div>

            <div class="radio">
                <input type="radio" name="cat_mode" value="new" onclick="toggleCat(true)">
                <label>–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é</label>
            </div>

            <div id="cat-new-box" class="hidden">
                <input type="text" name="new_category_name" class="form-control" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏">
            </div>
        </div>

        <!-- –û–ü–ò–°–ê–ù–ò–ï -->
        <div class="form-group">
            <label>–û–ø–∏—Å–∞–Ω–∏–µ</label>
            <textarea name="description" rows="2" class="form-control"></textarea>
        </div>

        {% if form.non_field_errors %}
            <div class="errorlist">{{ form.non_field_errors }}</div>
        {% endif %}

        <button id="submit-btn" type="submit" class="btn-submit btn-income">
            ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –¥–æ—Ö–æ–¥
        </button>

    </form>
</div>

<script>
function setType(type){
    document.getElementById('id_type').value = type;
    document.getElementById('btn-income').classList.toggle('active',type==='income');
    document.getElementById('btn-outcome').classList.toggle('active',type==='outcome');

    const btn=document.getElementById('submit-btn');
    btn.className='btn-submit '+(type==='income'?'btn-income':'btn-outcome');
    btn.innerText=type==='income'?'‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –¥–æ—Ö–æ–¥':'üí∏ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —Ä–∞—Å—Ö–æ–¥';

    document.getElementById('form-title').innerText=
        type==='income'?'üí∞ –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞':'üìâ –°–ø–∏—Å–∞–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤';
}

function toggleCat(isNew){
    document.getElementById('cat-old-box').classList.toggle('hidden',isNew);
    document.getElementById('cat-new-box').classList.toggle('hidden',!isNew);
    document.getElementById('id_category').disabled=isNew;
}

function addAmount(val){
    const i=document.getElementById('id_amount');
    i.value=(parseInt(i.value)||0)+val;
}

window.onload=()=>setType('income');
</script>
{% endblock %}
