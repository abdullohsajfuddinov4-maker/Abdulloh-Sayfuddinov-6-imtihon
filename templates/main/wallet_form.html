{% extends 'main/base.html' %}
{% load i18n %}

{% block title %}{% trans "–î–æ–±–∞–≤–∏—Ç—å –∫–æ—à–µ–ª—ë–∫" %}{% endblock %}

{% block extra_css %}
<style>
    .form-container {
        max-width: 600px;
        margin: 0 auto;
    }

    .form-header {
        text-align: center;
        margin-bottom: 30px;
    }

    .wallet-type-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 15px;
        margin-bottom: 25px;
    }

    .type-card {
        padding: 25px 20px;
        background: #fff;
        border: 3px solid #e0e0e0;
        border-radius: 12px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s;
    }

    .type-card:hover {
        border-color: #bbb;
        transform: translateY(-3px);
    }

    .type-card.active {
        border-color: #4CAF50;
        background: #f1f8f4;
    }

    .type-card input[type="radio"] {
        display: none;
    }

    .type-icon {
        font-size: 48px;
        margin-bottom: 10px;
    }

    .type-label {
        font-weight: 600;
        font-size: 16px;
        color: #333;
    }

    .currency-selector {
        display: flex;
        gap: 15px;
        background: #f5f5f5;
        padding: 10px;
        border-radius: 12px;
    }

    .currency-option {
        flex: 1;
        padding: 15px;
        text-align: center;
        background: #fff;
        border-radius: 8px;
        cursor: pointer;
        border: 2px solid transparent;
        transition: all 0.3s;
    }

    .currency-option:hover {
        border-color: #ddd;
    }

    .currency-option.active {
        border-color: #4CAF50;
        background: #f1f8f4;
    }

    .currency-option input[type="radio"] {
        display: none;
    }

    .currency-label {
        font-size: 18px;
        font-weight: 600;
        display: block;
    }

    .currency-code {
        font-size: 14px;
        color: #999;
        margin-top: 5px;
    }

    .info-box {
        background: #e3f2fd;
        border-left: 4px solid #2196F3;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
        font-size: 14px;
        color: #1565c0;
    }

    .errorlist {
        list-style: none;
        padding: 0;
        margin-top: 5px;
    }

    .errorlist li {
        color: #f44336;
        font-size: 14px;
        background: #ffebee;
        padding: 8px 12px;
        border-radius: 6px;
        margin-bottom: 5px;
    }

    @media (max-width: 768px) {
        .wallet-type-grid {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="form-container">
    <div class="form-header">
        <h1>‚ûï {% trans "–î–æ–±–∞–≤–∏—Ç—å –∫–æ—à–µ–ª—ë–∫" %}</h1>
        <p style="color: #666;">
            {% trans "–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –∫–æ—à–µ–ª—ë–∫ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ–∏–Ω–∞–Ω—Å–∞–º–∏" %}
        </p>
    </div>

    <div class="info-box">
        üí° <strong>{% trans "–í–Ω–∏–º–∞–Ω–∏–µ:" %}</strong>
        {% trans "–ö–∞—Ä—Ç–∞ VISA –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ –≤–∞–ª—é—Ç–µ UZS. –í—ã–±–µ—Ä–∏—Ç–µ USD –¥–ª—è –∫–∞—Ä—Ç VISA." %}
    </div>

    {% if form.non_field_errors %}
        <ul class="errorlist">
            {% for error in form.non_field_errors %}
                <li>{{ error }}</li>
            {% endfor %}
        </ul>
    {% endif %}

    <div class="card">
        <form method="post" id="walletForm">
            {% csrf_token %}

            <div class="form-group">
                <label for="{{ form.name.id_for_label }}">
                    üìù {% trans "–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞" %}
                </label>
                <input type="text"
                       name="name"
                       class="form-control"
                       id="{{ form.name.id_for_label }}"
                       value="{{ form.name.value|default:'' }}"
                       placeholder="{% trans '–ù–∞–ø—Ä–∏–º–µ—Ä: –û—Å–Ω–æ–≤–Ω–∞—è –∫–∞—Ä—Ç–∞, –ù–∞–ª–∏—á–Ω—ã–µ' %}"
                       required>
            </div>

            <div class="form-group">
                <label>üí≥ {% trans "–¢–∏–ø –∫–æ—à–µ–ª—å–∫–∞" %}</label>
                <div class="wallet-type-grid">
                    <div class="type-card" onclick="selectType('cash')">
                        <input type="radio" name="type" value="cash">
                        <div class="type-icon">üíµ</div>
                        <div class="type-label">{% trans "–ù–∞–ª–∏—á–Ω—ã–µ" %}</div>
                    </div>

                    <div class="type-card" onclick="selectType('uzcard')">
                        <input type="radio" name="type" value="uzcard" checked>
                        <div class="type-icon">üí≥</div>
                        <div class="type-label">{% trans "–ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–∞—Ä—Ç–∞" %}</div>
                    </div>

                    <div class="type-card" onclick="selectType('visa')">
                        <input type="radio" name="type" value="visa">
                        <div class="type-icon">üíé</div>
                        <div class="type-label">Visa</div>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>üí∞ {% trans "–í–∞–ª—é—Ç–∞" %}</label>
                <div class="currency-selector">
                    <div class="currency-option" onclick="selectCurrency('UZS')">
                        <input type="radio" name="currency" value="UZS" checked>
                        <span class="currency-label">üá∫üáø {% trans "–°—É–º" %}</span>
                        <span class="currency-code">UZS</span>
                    </div>

                    <div class="currency-option" onclick="selectCurrency('USD')">
                        <input type="radio" name="currency" value="USD">
                        <span class="currency-label">üá∫üá∏ {% trans "–î–æ–ª–ª–∞—Ä" %}</span>
                        <span class="currency-code">USD</span>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label for="{{ form.balance.id_for_label }}">
                    üíµ {% trans "–ù–∞—á–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å" %}
                </label>
                <input type="number"
                       name="balance"
                       step="0.01"
                       class="form-control"
                       id="{{ form.balance.id_for_label }}"
                       value="{{ form.balance.value|default:'0' }}"
                       placeholder="0.00">
                <span style="font-size: 13px; color: #999;">
                    {% trans "–£–∫–∞–∂–∏—Ç–µ —Ç–µ–∫—É—â—É—é —Å—É–º–º—É –≤ —ç—Ç–æ–º –∫–æ—à–µ–ª—å–∫–µ" %}
                </span>
            </div>

            <div style="display: flex; gap: 15px; margin-top: 30px;">
                <a href="{% url 'wallet_list' %}" class="btn btn-secondary" style="flex: 1;">
                    {% trans "–û—Ç–º–µ–Ω–∞" %}
                </a>
                <button type="submit" class="btn" style="flex: 1;">
                    ‚úÖ {% trans "–°–æ–∑–¥–∞—Ç—å –∫–æ—à–µ–ª—ë–∫" %}
                </button>
            </div>
        </form>
    </div>
</div>
<script>
    function selectType(type) {
        document.querySelectorAll('.type-card').forEach(card => {
            card.classList.remove('active');
        });
        event.currentTarget.classList.add('active');
        document.getElementById('type_' + type).checked = true;

        if (type === 'visa') {
            const uzsOption = document.getElementById('currency_uzs');
            if (uzsOption.checked) {
                document.getElementById('currency_usd').checked = true;
                selectCurrency('USD');
            }
        }
    }

    function selectCurrency(currency) {
        document.querySelectorAll('.currency-option').forEach(option => {
            option.classList.remove('active');
        });
        event.currentTarget.classList.add('active');
        document.getElementById('currency_' + currency.toLowerCase()).checked = true;
    }

    document.addEventListener('DOMContentLoaded', function() {
        const checkedType = document.querySelector('input[name="type"]:checked');
        if (checkedType) {
            checkedType.closest('.type-card').classList.add('active');
        }

        const checkedCurrency = document.querySelector('input[name="currency"]:checked');
        if (checkedCurrency) {
            checkedCurrency.closest('.currency-option').classList.add('active');
        }
    });
</script>
{% endblock %}





